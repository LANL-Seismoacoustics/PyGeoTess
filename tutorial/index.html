<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Jonathan K. MacCarthy">
        <link rel="canonical" href="http://lanl-seismoacoustics.github.io/pygeotess/tutorial/">
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Tutorial - PyGeoTess</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="..">PyGeoTess</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="..">Introduction</a>
                </li>
            
            
            
                <li class="active">
                    <a href="./">Tutorial</a>
                </li>
            
            
            
                <li >
                    <a href="../license/">License</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li >
                    <a rel="next" href="..">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../license/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/lanl-seismoacoustics/pygeotess">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#tutorial">Tutorial</a></li>
        
            <li><a href="#working-with-grids">Working with grids</a></li>
        
            <li><a href="#working-with-models">Working with Models</a></li>
        
            <li><a href="#create-a-model-from-scratch">Create a Model from scratch</a></li>
        
    
        <li class="main "><a href="#roadmap">Roadmap</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h2 id="tutorial">Tutorial<a class="headerlink" href="#tutorial" title="Permanent link">&para;</a></h2>
<h3 id="working-with-grids">Working with grids<a class="headerlink" href="#working-with-grids" title="Permanent link">&para;</a></h3>
<h4 id="load-a-grid">Load a grid<a class="headerlink" href="#load-a-grid" title="Permanent link">&para;</a></h4>
<p>Grids are made using a Java utility called <code>GeoTessBuilder</code>.  Loading them into
memory from file is the standard constructor in PyGeoTess.  Viewing grid metadata is as simple as using <code>print</code> or <code>str</code>.</p>
<pre><code class="python">from geotess import Grid

grid = Grid('geotess/data/geotess_grid_16000.geotess')
print(grid)
</code></pre>

<pre><code>GeoTessGrid
gridID = 4FD3D72E55EFA8E13CA096B4C8795F03
memory : 0.11776 MB
input Grid File : geotess/data/geotess_grid_16000.geotess
generated by software version : GridBuilder 0.0.0  Fri May 25 11:34:59 MDT 2012

nTessellations = 1
nLevels = 3
nVertices = 162
nTriangles = 420

    Tess    Level  LevelID     NTri    First   Last+1
      0        0        0       20        0       20
      0        1        1       80       20      100
      0        2        2      320      100      420
</code></pre>

<h4 id="built-in-grids">Built-in grids<a class="headerlink" href="#built-in-grids" title="Permanent link">&para;</a></h4>
<p>The grids and models that GeoTess distributes are also part of PyGeoTess.  The files are found in <code>geotess/data</code>, but they are also pre-loaded into class instances.  Here, we simply import the previous grid.</p>
<pre><code class="python">from geotess.data import grid_16000

print(grid_16000)
</code></pre>

<pre><code>GeoTessGrid
gridID = 4FD3D72E55EFA8E13CA096B4C8795F03
memory : 0.11776 MB
input Grid File : geotess/data/geotess_grid_16000.geotess
generated by software version : GridBuilder 0.0.0  Fri May 25 11:34:59 MDT 2012

nTessellations = 1
nLevels = 3
nVertices = 162
nTriangles = 420

    Tess    Level  LevelID     NTri    First   Last+1
      0        0        0       20        0       20
      0        1        1       80       20      100
      0        2        2      320      100      420
</code></pre>

<h4 id="get-vertices-and-triangles">Get vertices and triangles<a class="headerlink" href="#get-vertices-and-triangles" title="Permanent link">&para;</a></h4>
<p>In PyGeoTess, Grid vertices are geocentric coordinates of points of intersection on a tessellation, and triangles are the three integer vertex indices that form a triangle in the tessellation.  For a given grid, all vertices are accessible via the <code>Grid.vertices</code> method, and the triangles (vertex associations) for a particular tessellation and level are gotten with the <code>Grid.triangles</code> method.</p>
<pre><code class="python">vertices = grid.vertices()
triangles = grid.triangles(tess=0, level=2)

print(&quot;The first 10 vertices are:\n{}&quot;.format(vertices[:10]))
print(&quot;The first 10 triangles are:\n{}&quot;.format(triangles[:10]))
</code></pre>

<pre><code>The first 10 vertices are:
[[   0.           90.        ]
 [  72.           26.71930078]
 [   0.           26.71930078]
 [ 144.           26.71930078]
 [-144.           26.71930078]
 [ -72.           26.71930078]
 [  36.          -26.71930078]
 [ 108.          -26.71930078]
 [-180.          -26.71930078]
 [-108.          -26.71930078]]
The first 10 triangles are:
[[42 43 44]
 [12 44 43]
 [13 42 44]
 [14 43 42]
 [42 45 46]
 [ 0 46 45]
 [14 42 46]
 [13 45 42]
 [43 47 48]
 [ 1 48 47]]
</code></pre>

<h4 id="plotting-grids">Plotting grids<a class="headerlink" href="#plotting-grids" title="Permanent link">&para;</a></h4>
<p>The methods for vertices and triangles above makes them ammenable to plotting using Matplotlib's <a href="http://matplotlib.org/1.5.0/examples/pylab_examples/triplot_demo.html"><code>triplot</code></a> function.</p>
<pre><code class="python">import matplotlib.pyplot as plt

plt.triplot(vertices[:,0], vertices[:,1], triangles);
</code></pre>

<p><img alt="png" src="../output_7_1.png" /></p>
<p>The cirularity of vertex longitudes makes plotting tricky.  Luckily, Matplotlib has the tools <a href="http://matplotlib.org/api/tri_api.html#matplotlib.tri.Triangulation">'Triangulation'</a> and <a href="http://matplotlib.org/api/tri_api.html#matplotlib.tri.TriAnalyzer">'TriAnalyzer'</a> to mask out these long, flat triangles from the plot!</p>
<pre><code class="python">from matplotlib.tri import Triangulation, TriAnalyzer

tri = Triangulation(vertices[:,0], vertices[:,1], triangles)
tri_an = TriAnalyzer(tri)

mask = tri_an.get_flat_tri_mask(min_circle_ratio=0.1, rescale=True)
plt.triplot(vertices[:,0], vertices[:,1], triangles, mask=mask)
</code></pre>

<p><img alt="png" src="../output_9_1.png" /></p>
<p>Now, let's plot them on a real map, using Matplotlib <a href="http://matplotlib.org/basemap/users/examples.html">Basemap</a>!</p>
<pre><code class="python">from mpl_toolkits.basemap import Basemap

plt.figure(figsize=(15,7))
m = Basemap()
m.etopo()
plt.triplot(vertices[:,0], vertices[:,1], triangles, mask=mask, color='k')
</code></pre>

<p><img alt="png" src="../output_11_1.png" /></p>
<p>Not perfect, but not as messy.</p>
<h3 id="working-with-models">Working with Models<a class="headerlink" href="#working-with-models" title="Permanent link">&para;</a></h3>
<p>Models can be loaded from file, or constructed from scratch (a grid file is still required).</p>
<h4 id="load-from-file">Load from file<a class="headerlink" href="#load-from-file" title="Permanent link">&para;</a></h4>
<pre><code class="python">from geotess import Model

model = Model.read('geotess/data/crust20.geotess')
print(model)
</code></pre>

<pre><code>********************************************************************************

GeoTessModel:
OS: Undefined 64-bit mode
Input Model File: geotess/data/crust20.geotess
Input Grid File: *

Generated by: GeoModel 7.0.1  Wed April 18 15:21:51 2012
Model Load Time: 0.000 sec
Memory footprint: 18.5971 MB

Model Description: 
The Crust 2.0 model of Bassin, Laske and Masters (2000).

Bassin, C., Laske, G. and Masters, G., 
The Current Limits of Resolution for Surface Wave 
Tomography in North America, EOS Trans AGU, 81, F897, 2000.

http://igppweb.ucsd.edu/~gabi/crust2.html

The original model was defined on a regular latitude-longitude
grid with 2 degree by 2 degree spacing.  It was cell-based,
meaning that the model attributes (p velocity, s velocity and
density) were attached to the cells, not the nodes at the 
corners of the cells.

This representation uses a triangular tessellation with 
1 degree edge lengths and it is node based, meaning that
the attributes are attached to the nodes at the corners
of the triangles, not the triangles.  The translation
was accomplished by first defining a node at the center 
of each 2 degree cell in the original model and then
interpolating attribute values at the nodes of the 
new model using simple bi-linear interpolation.  There
was certainly some interpolation error involved in this 
process.

In this representation, the water layer has been omitted.
The top of the new model is the surface of the solid 
Earth.  While the thickness of the water layer in the 
oceans can be deduced in the new model by assuming that
the surface of the oceans corresponds to depth zero, the
thickness of the water layer in large inland lakes and
seas has been lost.

In the new representation, layer boundaries are defined in 
terms of radius, not depth.  Depths in the original model
were converted to radius using the radius of the WGS84
ellipsoid.

Sandy Ballard
Sandia National Laboratories
sballar@sandia.gov
4/14/2012
&lt;end description&gt;

EarthShape: WGS84
DataType: FLOAT
Attributes: 
  0:  vp  (km/sec)
  1:  vs  (km/sec)
  2:  density  (g/cc)

Layers: 
  Index  TessId    Name
   6       0     ice
   5       0     soft_sediments
   4       0     hard_sediments
   3       0     upper_crust
   2       0     middle_crust
   1       0     lower_crust
   0       0     mantle


Layer  connected   number    profile   profile    profile  profile  profile  profile
Index  vertices   of points  npoints   constant    thin     empty   surface surfemtpy
-----  --------   ---------  -------   --------   ------   -------  -------  -------
   6    40962        40962         0       1542    39420         0       0       0
   5    40962        40962         0      39267     1695         0       0       0
   4    40962        40962         0      13561    27401         0       0       0
   3    40962        40962         0      40962        0         0       0       0
   2    40962        40962         0      40962        0         0       0       0
   1    40962        40962         0      40962        0         0       0       0
   0    40962        40962         0          0    40962         0       0       0
-----  --------   ---------  -------   --------   ------   -------  -------  -------
Total   40962       286734         0     177256   109478         0       0       0

GeoTessGrid
gridID = 808785948EB2350DD44E6C29BDEA6CAE
memory : 34.2188 MB
input Grid File : geotess/data/crust10.geotess
generated by software version : GeoModel 7.0.1  Wed April 18 15:21:51 2012

nTessellations = 1
nLevels = 7
nVertices = 40962
nTriangles = 109220

    Tess    Level  LevelID     NTri    First   Last+1
      0        0        0       20        0       20
      0        1        1       80       20      100
      0        2        2      320      100      420
      0        3        3     1280      420     1700
      0        4        4     5120     1700     6820
      0        5        5    20480     6820    27300
      0        6        6    81920    27300   109220


********************************************************************************
</code></pre>

<p>Each <code>Model</code> has a <code>.grid</code>, which provides access to that Model's Grid instance.</p>
<p>Just like with <code>Grids</code>, PyGeoTess is distribed with the same GeoTess model files, like Crust2.0, which can be directly imported.</p>
<pre><code class="python">from geotess.data import crust20

print(crust20)
</code></pre>

<pre><code>********************************************************************************

GeoTessModel:
OS: Undefined 64-bit mode
Input Model File: geotess/data/crust20.geotess
Input Grid File: *

Generated by: GeoModel 7.0.1  Wed April 18 15:21:51 2012
Model Load Time: 1.000 sec
Memory footprint: 18.5971 MB

Model Description: 
The Crust 2.0 model of Bassin, Laske and Masters (2000).

Bassin, C., Laske, G. and Masters, G., 
The Current Limits of Resolution for Surface Wave 
Tomography in North America, EOS Trans AGU, 81, F897, 2000.

http://igppweb.ucsd.edu/~gabi/crust2.html

The original model was defined on a regular latitude-longitude
grid with 2 degree by 2 degree spacing.  It was cell-based,
meaning that the model attributes (p velocity, s velocity and
density) were attached to the cells, not the nodes at the 
corners of the cells.

This representation uses a triangular tessellation with 
1 degree edge lengths and it is node based, meaning that
the attributes are attached to the nodes at the corners
of the triangles, not the triangles.  The translation
was accomplished by first defining a node at the center 
of each 2 degree cell in the original model and then
interpolating attribute values at the nodes of the 
new model using simple bi-linear interpolation.  There
was certainly some interpolation error involved in this 
process.

In this representation, the water layer has been omitted.
The top of the new model is the surface of the solid 
Earth.  While the thickness of the water layer in the 
oceans can be deduced in the new model by assuming that
the surface of the oceans corresponds to depth zero, the
thickness of the water layer in large inland lakes and
seas has been lost.

In the new representation, layer boundaries are defined in 
terms of radius, not depth.  Depths in the original model
were converted to radius using the radius of the WGS84
ellipsoid.

Sandy Ballard
Sandia National Laboratories
sballar@sandia.gov
4/14/2012
&lt;end description&gt;

EarthShape: WGS84
DataType: FLOAT
Attributes: 
  0:  vp  (km/sec)
  1:  vs  (km/sec)
  2:  density  (g/cc)

Layers: 
  Index  TessId    Name
   6       0     ice
   5       0     soft_sediments
   4       0     hard_sediments
   3       0     upper_crust
   2       0     middle_crust
   1       0     lower_crust
   0       0     mantle


Layer  connected   number    profile   profile    profile  profile  profile  profile
Index  vertices   of points  npoints   constant    thin     empty   surface surfemtpy
-----  --------   ---------  -------   --------   ------   -------  -------  -------
   6    40962        40962         0       1542    39420         0       0       0
   5    40962        40962         0      39267     1695         0       0       0
   4    40962        40962         0      13561    27401         0       0       0
   3    40962        40962         0      40962        0         0       0       0
   2    40962        40962         0      40962        0         0       0       0
   1    40962        40962         0      40962        0         0       0       0
   0    40962        40962         0          0    40962         0       0       0
-----  --------   ---------  -------   --------   ------   -------  -------  -------
Total   40962       286734         0     177256   109478         0       0       0

GeoTessGrid
gridID = 808785948EB2350DD44E6C29BDEA6CAE
memory : 34.2188 MB
input Grid File : geotess/data/crust10.geotess
generated by software version : GeoModel 7.0.1  Wed April 18 15:21:51 2012

nTessellations = 1
nLevels = 7
nVertices = 40962
nTriangles = 109220

    Tess    Level  LevelID     NTri    First   Last+1
      0        0        0       20        0       20
      0        1        1       80       20      100
      0        2        2      320      100      420
      0        3        3     1280      420     1700
      0        4        4     5120     1700     6820
      0        5        5    20480     6820    27300
      0        6        6    81920    27300   109220


********************************************************************************
</code></pre>

<h3 id="create-a-model-from-scratch">Create a Model from scratch<a class="headerlink" href="#create-a-model-from-scratch" title="Permanent link">&para;</a></h3>
<p>Creating a GeoTessModel from scratch requires a grid file, some layers, and some attributes.  PyGeoTess describes layers with 2-tuples.  The first entry is the layer name, the second is the correspoding tessellation id.  Similarly, with names and units, for attributes.  Convenience <a href="https://docs.python.org/2/library/collections.html#collections.namedtuple"><code>namedtuple</code></a> are provided, for readability.</p>
<pre><code class="python"># look at the grid, so you can assign layers to tessellation ids.
from geotess.data import grid_16000
from geotess import Model, Layer, Attribute

print(grid_16000)
</code></pre>

<pre><code>GeoTessGrid
gridID = 4FD3D72E55EFA8E13CA096B4C8795F03
memory : 0.11776 MB
input Grid File : geotess/data/geotess_grid_16000.geotess
generated by software version : GridBuilder 0.0.0  Fri May 25 11:34:59 MDT 2012

nTessellations = 1
nLevels = 3
nVertices = 162
nTriangles = 420

    Tess    Level  LevelID     NTri    First   Last+1
      0        0        0       20        0       20
      0        1        1       80       20      100
      0        2        2      320      100      420
</code></pre>

<pre><code class="python">crust = Layer(name='crust', tess_id=0)
mantle = Layer('mantle', 0)

Vp = Attribute(name='Vp', unit='km/s')
Vs = Attribute('Vs', 'km/s')

desc = &quot;My awesome model.&quot;
model = Model('geotess/data/geotess_grid_16000.geotess', layers=[crust, mantle], attributes=[Vp, Vs], 
              dtype='float', earth_shape='wgs84', rconst=False, description=desc)

print(model)
````

````    
********************************************************************************

GeoTessModel:
OS: Undefined 64-bit mode
Input Model File: none
Input Grid File: geotess/data/geotess_grid_16000.geotess

Generated by: PyGeoTess v0.1.1  2015-11-18 15:35:20.303894
Model Load Time: -1.000 sec
Memory footprint: 0.000646591 MB

Model Description: 
My awesome model.
&lt;end description&gt;

EarthShape: WGS84
DataType: FLOAT
Attributes: 
  0:  Vp  (km/s)
  1:  Vs  (km/s)

Layers: 
  Index  TessId    Name
   1       0     MANTLE
   0       0     CRUST


GeoTessGrid
gridID = 4FD3D72E55EFA8E13CA096B4C8795F03
memory : 0.11776 MB
input Grid File : geotess/data/geotess_grid_16000.geotess
generated by software version : GridBuilder 0.0.0  Fri May 25 11:34:59 MDT 2012

nTessellations = 1
nLevels = 3
nVertices = 162
nTriangles = 420

    Tess    Level  LevelID     NTri    First   Last+1
      0        0        0       20        0       20
      0        1        1       80       20      100
      0        2        2      320      100      420


********************************************************************************
</code></pre>

<p>Now, let's save it.</p>
<pre><code class="python"># binary version
model.write('myawesome.geotess')

# ascii version
model.write('myawesome.ascii')
</code></pre>

<h2 id="roadmap">Roadmap<a class="headerlink" href="#roadmap" title="Permanent link">&para;</a></h2>
<p>Make PyGeoTess work with both the standard CPython interpretor, using the GeoTess
c++ library and Cython, and the <a href="http://jython.org">Jython</a> Python interpeter,
using the GeoTess Java library.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
                <center>Copyright 2015. Los Alamos National Security, LLC</center>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script src="../js/base.js"></script>
    </body>
</html>